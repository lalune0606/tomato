<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#e74c3c">
    <meta name="description" content="一个简洁的番茄工作法计时器">
    
    <!-- PWA配置 -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple设备支持 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>番茄专注时钟</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
</head>
<body>
    <!-- 主容器 -->
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <h1><i class="fas fa-clock"></i> 番茄时钟</h1>
            <div class="stats">
                <span id="today-count">今日: 0</span>
                <span id="total-count">总计: 0</span>
            </div>
        </header>

        <!-- 主计时器 -->
        <main class="main">
            <!-- 状态显示 -->
            <div class="status" id="status">
                <span class="badge work">工作中</span>
                <span class="badge break hidden">休息中</span>
            </div>
            
            <!-- 环形计时器 -->
            <div class="timer-container">
                <svg class="progress-ring" width="300" height="300">
                    <circle class="progress-ring__background" stroke="#eee" stroke-width="12" fill="transparent" r="130" cx="150" cy="150"/>
                    <circle class="progress-ring__circle" stroke="#e74c3c" stroke-width="12" fill="transparent" r="130" cx="150" cy="150"
                            stroke-dasharray="817" stroke-dashoffset="817"/>
                </svg>
                <div class="timer-display">
                    <div id="time">25:00</div>
                    <div class="timer-label" id="timer-label">专注时间</div>
                </div>
            </div>
            
            <!-- 控制按钮 -->
            <div class="controls">
                <button id="start-btn" class="btn btn-primary">
                    <i class="fas fa-play"></i> 开始
                </button>
                <button id="pause-btn" class="btn btn-secondary" disabled>
                    <i class="fas fa-pause"></i> 暂停
                </button>
                <button id="reset-btn" class="btn btn-secondary">
                    <i class="fas fa-redo"></i> 重置
                </button>
                <button id="skip-btn" class="btn btn-secondary">
                    <i class="fas fa-forward"></i> 跳过
                </button>
            </div>
            
            <!-- 任务列表 -->
            <div class="tasks-section">
                <h2><i class="fas fa-tasks"></i> 任务列表</h2>
                <div class="task-input">
                    <input type="text" id="task-input" placeholder="添加新任务...">
                    <input type="number" id="task-pomos" min="1" max="10" value="1" title="目标番茄数">
                    <button id="add-task-btn" class="btn btn-success">
                        <i class="fas fa-plus"></i> 添加
                    </button>
                </div>
                <ul id="task-list" class="task-list">
                    <!-- 任务项将通过JS动态添加 -->
                </ul>
            </div>
        </main>

        <!-- 底部导航 -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="timer">
                <i class="fas fa-clock"></i>
                <span>计时器</span>
            </button>
            <button class="nav-btn" data-page="tasks">
                <i class="fas fa-tasks"></i>
                <span>任务</span>
            </button>
            <button class="nav-btn" data-page="stats">
                <i class="fas fa-chart-bar"></i>
                <span>统计</span>
            </button>
            <button class="nav-btn" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>设置</span>
            </button>
        </nav>
    </div>

    <!-- 设置面板（隐藏） -->
    <div id="settings-panel" class="panel hidden">
        <div class="panel-header">
            <h2><i class="fas fa-cog"></i> 设置</h2>
            <button id="close-settings" class="btn btn-icon">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-content">
            <!-- 设置内容将通过JS动态生成 -->
        </div>
    </div>

    <!-- 统计面板（隐藏） -->
    <div id="stats-panel" class="panel hidden">
        <div class="panel-header">
            <h2><i class="fas fa-chart-bar"></i> 统计</h2>
            <button id="close-stats" class="btn btn-icon">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-content">
            <div class="stats-summary">
                <div class="stat-item">
                    <h3>今日番茄</h3>
                    <div class="stat-value" id="today-pomos">0</div>
                </div>
                <div class="stat-item">
                    <h3>本周总计</h3>
                    <div class="stat-value" id="week-pomos">0</div>
                </div>
                <div class="stat-item">
                    <h3>专注时长</h3>
                    <div class="stat-value" id="total-time">0小时</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="pomo-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- 音频元素 -->
    <audio id="bell-sound" preload="auto">
        <source src="sounds/bell.mp3" type="audio/mpeg">
    </audio>

    <!-- 脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
    
    <!-- 注册Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker 注册成功: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker 注册失败: ', err);
                    });
            });
        }
    </script>
</body>
</html>